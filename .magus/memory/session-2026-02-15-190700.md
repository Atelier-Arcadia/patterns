# Session: MCP Suggest Tool

Date: 2026-02-15
Status: completed

## Task Summary
Added a `suggest` MCP tool that allows LLM users to submit new pattern suggestions or edits to existing patterns, with a required `source` identifier for traceability.

## New Learnings

### Architecture Patterns
- `PatternStore` interface was read-only; created a separate `SubmissionStore` interface for submission capabilities
- `createServer()` now accepts `PatternStore & SubmissionStore` intersection type, keeping interfaces composable
- SQLite migration pattern: use `PRAGMA table_info()` to check for column existence before `ALTER TABLE ADD COLUMN`

### MCP Inspector CLI
- The Inspector CLI requires `--cli npx -- tsx src/stdio.ts` format (note the `--` separator) when the server command has arguments
- Without the `--` separator, the Inspector fails with `ENOENT` because it treats the whole string as one command
- Empty string args (e.g. `source=""`) cause the Inspector to reject with "Invalid parameter format"

### Testing
- Tool handler tests can use `SqlitePatternStore` directly since it implements both `PatternStore` and `SubmissionStore`
- Integration tests via `InMemoryTransport` validate the full MCP round-trip including Zod schema validation

## Artifacts Created
- Tests: 2 new store tests, 6 new tool handler tests, 3 new integration tests (116 total, all passing)
- Code: `src/types.ts` (source field + SubmissionStore interface), `src/sqlite-store.ts` (source column + migration), `src/tools.ts` (createSuggestHandler), `src/server.ts` (suggest tool registration), `src/api.ts` (source field passthrough)
- Plan: `docs/plans/2026-02-15-mcp-suggest-tool.md`
- Feature: `docs/features/2026-02-15-mcp-suggest-tool.md`

## Validation Performed
- All 116 tests pass (store: 57, tools: 14, API: 37, integration: 8)
- MCP Inspector: tools/list shows all 3 tools with correct schemas
- MCP Inspector: suggest tool creates pending submission with source field
- MCP Inspector: existing discover/match tools work without regression
