# Session: Auto-create domains and categories on approval

Date: 2026-02-15 (late) / 2026-02-16 (early)
Status: completed

## Task Summary
When approving a pattern suggestion that references a nonexistent domain or category, the system now auto-creates them instead of throwing an error. The web UI shows impact warnings before approval.

## New Learnings

### Express Type Safety
- Express types `req.params` as `Record<string, string | string[]>`, not `Record<string, string>` as commonly assumed
- A `getParam()` helper function that handles `Array.isArray` normalization is the clean fix
- This is a recurring Express gotcha worth remembering for any route handler

### Transaction Wrapping for Multi-Entity Creation
- When creating multiple related entities (domain + category + pattern), wrap in `this.db.transaction()` for atomicity
- better-sqlite3's transaction helper automatically handles rollback on throw

### Impact Preview Pattern
- Before a destructive or creative action, compute what *would* happen and show it to the user
- `getSubmissionImpact()` checks existence without mutating, returning a preview of side effects
- This was enriched inline on the existing `GET /submissions` response rather than creating a separate endpoint

### Slug-to-Name Convention
- `slugToName()` converts kebab-case to Title Case: `"my-domain"` -> `"My Domain"`
- Auto-created entities use generic descriptions: "Auto-created domain", "Auto-created category"

## Artifacts Created
- Tests: 13 new tests (11 store, 2 API), 1 existing test changed (throw -> auto-create). Total: 133 passing
- Code: `src/types.ts` (SubmissionImpact), `src/sqlite-store.ts` (slugToName, ensureDomainExists, ensureCategoryExists, getSubmissionImpact), `src/api.ts` (getParam, impact enrichment), `src/public/index.html` (impact warnings in UI)

## Validation Performed
- All 133 tests pass (store: 68, tools: 16, API: 39, integration: 10)
- TypeScript compilation clean after getParam() fix
